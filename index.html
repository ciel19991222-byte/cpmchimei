<script>
    const rawData = [...]; // ← 你原本的資料 그대로 不用動

    let searchTimer;

    function normalize(str) {
        return str
            .toString()
            .trim()
            .replace(/\u3000/g, ' ') // 全形空白轉半形
            .toLowerCase();
    }

    function debounceSearch() {
        clearTimeout(searchTimer);
        searchTimer = setTimeout(doSearch, 300);
    }

    function doSearch() {
        const keyword = normalize(document.getElementById('nameInput').value);
        const resultsDiv = document.getElementById('results');

        if (!keyword) {
            resultsDiv.innerHTML = `
                <div class="empty-state">
                    <div>請輸入關鍵字開始查詢</div>
                </div>`;
            return;
        }

        const filtered = rawData.filter(row => {
            const table = normalize(row[0]);
            const dept  = normalize(row[1]);
            const name  = normalize(row[2]);
            const title = normalize(row[3] || '');

            return (
                name.includes(keyword) ||
                dept.includes(keyword) ||
                title.includes(keyword) ||
                table.includes(keyword)
            );
        });

        if (filtered.length === 0) {
            resultsDiv.innerHTML = `
                <div class="empty-state">
                    <div>查無資料</div>
                </div>`;
            return;
        }

        resultsDiv.innerHTML = filtered.map((d, index) => `
            <div class="dr-card" style="animation-delay:${index * 0.05}s">
                <div class="dr-info">
                    <div class="dr-name">
                        ${d[2]}
                        <span class="dr-title">${d[3] || ''}</span>
                    </div>
                    <div class="dr-dept">${d[1]}</div>
                </div>
                <div class="seat-box">
                    <span class="seat-label">Table</span>
                    <span class="seat-num">${d[0]}</span>
                </div>
            </div>
        `).join('');
    }
</script>
